function getRankInfo(i,e){var t=Number.MAX_VALUE;i.stirfry>0&&(t=Math.min(t,e.stirfryVal/i.stirfry)),i.boil>0&&(t=Math.min(t,e.boilVal/i.boil)),i.knife>0&&(t=Math.min(t,e.knifeVal/i.knife)),i.fry>0&&(t=Math.min(t,e.fryVal/i.fry)),i.bake>0&&(t=Math.min(t,e.bakeVal/i.bake)),i.steam>0&&(t=Math.min(t,e.steamVal/i.steam));var a={},r=0,n="-",o=0;return t!=Number.MAX_VALUE&&(t>=5?(r=100,n="传",o=5):t>=4?(r=50,n="神",o=4):t>=3?(r=30,n="特",o=3):t>=2?(r=10,n="优",o=2):t>=1&&(r=0,n="可",o=1)),a.rankAddition=r,a.rankDisp=n,a.rankVal=o,a}function getRecipeSkillAddition(i,e,t,a){var r=0,n=1;for(var o in i){if(a&&i[o].conditionType){if(!i[o].conditionMatch)continue;n=i[o].conditionMatch}var f=i[o].type,s=!1;if("UseAll"==f)e.rarity==i[o].rarity&&(s=!0);else if("UseFish"==f){for(var l in e.materials)if("池塘"==e.materials[l].origin){s=!0;break}}else if("UseCreation"==f){for(var l in e.materials)if("作坊"==e.materials[l].origin){s=!0;break}}else if("UseMeat"==f){for(var l in e.materials)if("牧场"==e.materials[l].origin||"鸡舍"==e.materials[l].origin||"猪圈"==e.materials[l].origin){s=!0;break}}else if("UseVegetable"==f){for(var l in e.materials)if("菜棚"==e.materials[l].origin||"菜地"==e.materials[l].origin||"森林"==e.materials[l].origin){s=!0;break}}else"UseStirfry"==f?e.stirfry>0&&(s=!0):"UseBoil"==f?e.boil>0&&(s=!0):"UseFry"==f?e.fry>0&&(s=!0):"UseKnife"==f?e.knife>0&&(s=!0):"UseBake"==f?e.bake>0&&(s=!0):"UseSteam"==f?e.steam>0&&(s=!0):"UseSweet"==f?"Sweet"==e.condiment&&(s=!0):"UseSour"==f?"Sour"==e.condiment&&(s=!0):"UseSpicy"==f?"Spicy"==e.condiment&&(s=!0):"UseSalty"==f?"Salty"==e.condiment&&(s=!0):"UseBitter"==f?"Bitter"==e.condiment&&(s=!0):"UseTasty"==f?"Tasty"==e.condiment&&(s=!0):"Gold_Gain"==f?t&&0!=t.Id&&!t.Satiety||(s=!0):"CookbookPrice"==f&&(s=!0);s&&(r+=i[o].value*n)}return+r.toFixed(2)}function getRecipeBasicAddition(i){var e=0,t=1;for(var a in i)if("BasicPrice"==i[a].type){if(i[a].conditionType){if(!i[a].conditionMatch)continue;t=i[a].conditionMatch}e+=i[a].value*t}return+e.toFixed(2)}function updateConditionMatch(i,e,t,a,r){for(var n in i){var o=i[n];if(o.conditionType)if(o.conditionMatch=0,"PerRank"==o.conditionType)for(var f in r){t=r[f].data;if(t){var s=getRankInfo(t,e);s.rankVal>=o.conditionValue&&(o.conditionMatch+=1)}}else if("ExcessCookbookNum"==o.conditionType)a>=o.conditionValue&&(o.conditionMatch=1);else if("SameSkill"==o.conditionType){var l=0,c=0,d=0,p=0,u=0,m=0,b=0;for(var f in r){t=r[f].data;if(!t)return;t.stirfry>0&&(c++,3==c&&l++),t.boil>0&&(d++,3==d&&l++),t.knife>0&&(p++,3==p&&l++),t.fry>0&&(u++,3==u&&l++),t.bake>0&&(m++,3==m&&l++),t.steam>0&&(b++,3==b&&l++)}o.conditionMatch=l}}}function getMaterialsAddition(i,e){var t=0;for(var a in i.materials)for(var r in e)if(i.materials[a].material==e[r].materialId&&e[r].addition){t+=Number(e[r].addition);break}return+t.toFixed(2)}function buildRecipeMenu(i){var e=[],t={};return t.data=i,e.push(t),e}function getPercentDisp(i){return 0!=i?i.toString()+"%":""}function getAbsDisp(i){return 0==i?"":i.toString()}function getRecipeQuantity(i,e,t){var a=1;for(var r in t.hasOwnProperty("DisableMultiCookbook")&&0!=t.DisableMultiCookbook||(a=i.limitVal),i.materials){var n=!1;for(var o in e)if(i.materials[r].material==e[o].materialId){if(n=!0,e[o].quantity){var f=Math.floor(e[o].quantity/i.materials[r].quantity);f<a&&(a=f);break}if(0===e[o].quantity)return 0}if(!n)return 0}return a<0?0:a}function getRecipeResult(i,e,t,a,r,n,o,f,s,l,c,d,p){var u={},m=0,b=0,v=0,h=0,y=0,A=0,k=new Addition,D=0;if(i&&i.chefId){var g=getRankInfo(t,i);if(u.rankVal=g.rankVal,u.rankDisp=g.rankDisp,!l&&0==g.rankVal)return u;if(o&&o.hasOwnProperty("DisableCookbookRank")&&0!=o.DisableCookbookRank||(m=g.rankAddition),u.rankAdditionDisp=getPercentDisp(m),(!o||!o.hasOwnProperty("DisableChefSkillEffect")||0==o.DisableChefSkillEffect)&&(updateConditionMatch(i.specialSkillEffect,i,t,a,c),b=getRecipeSkillAddition(i.specialSkillEffect,t,o,!0),k.percent=getRecipeBasicAddition(i.specialSkillEffect),updateConditionMatch(i.selfUltimateEffect,i,t,a,c),b+=getRecipeSkillAddition(i.selfUltimateEffect,t,o,!0),k.percent+=getRecipeBasicAddition(i.selfUltimateEffect),d))for(var S in d)D+=getRecipeSkillAddition(d[S].effect,t,o,!0),k.percent+=getRecipeBasicAddition(d[S].effect);if(u.chefSkillAdditionDisp=getPercentDisp(b),(!o||!o.hasOwnProperty("DisableEquipSkillEffect")||0==o.DisableEquipSkillEffect)&&e&&e.effect){var M=updateEquipmentEffect(e.effect,i.selfUltimateEffect);updateConditionMatch(M,i,t,a,c),v=getRecipeSkillAddition(M,t,o,!0),k.percent+=getRecipeBasicAddition(M)}u.equipSkillAdditionDisp=getPercentDisp(v),y+=Number(i.addition)}if(u.satiety=t.rarity,p){var V=0;for(var E in p){var P=p[E].effectType,I=p[E].effectValue;"IntentAdd"==P&&(V+=I)}var w=new Addition,C=0,U=new Addition;for(var E in p){var R=p[E].buffId;P=p[E].effectType,I=p[E].effectValue;"BasicPriceChange"==P?(R||(I*=1+.01*V),w.abs+=I):"BasicPriceChangePercent"==P?(R||(I*=1+.01*V),w.percent+=I):"SatietyChange"==P?(R||(I*=1+.01*V),U.abs+=I):"SatietyChangePercent"==P?(R||(I*=1+.01*V),U.percent+=I):"SetSatietyValue"==P?u.satiety=I:"PriceChangePercent"==P&&(R||(I*=1+.01*V),C+=I)}k.abs+=w.abs,k.percent+=w.percent,y+=C/100,u.satiety=Math.ceil(calAddition(u.satiety,U))}if(u.partialAdditionDisp=getPercentDisp(D),u.basicPercentDisp=getPercentDisp(k.percent),u.basicAbsDisp=getAbsDisp(k.abs),o&&o.hasOwnProperty("DisableCondimentEffect")&&0!=o.DisableCondimentEffect||s&&(u.useCondiment=!0,A=getRecipeSkillAddition(s.effect,t,o,!1)),u.condimentSkillAdditionDisp=getPercentDisp(A),o&&o.hasOwnProperty("DisableDecorationEffect")&&0!=o.DisableDecorationEffect||f&&(h=f),u.decorationAdditionDisp=getPercentDisp(h),y+=Number(t.addition),o&&o.hasOwnProperty("MaterialsEffect")){var N=getMaterialsAddition(t,n);y+=N}var T=(m+b+v+A+h+t.ultimateAddition+D)/100,q=calAddition(t.price,k);p||(q=Math.floor(q)),u.data=t,u.quantity=a,u.max=r,u.limit=a,u.bonusAdditionDisp=getPercentDisp(+(100*y).toFixed(2)),u.totalPrice=t.price*a,u.realPrice=Math.ceil(+(q*(1+T)).toFixed(2));var x=Math.ceil(+(q*(1+T+y)).toFixed(2));u.bonusScore=x-u.realPrice,u.totalBonusScore=u.bonusScore*a,u.score=x,u.totalScore=x*a,u.totalTime=t.time*a,u.totalTimeDisp=secondsToTime(u.totalTime);var F=Math.floor(3600*u.realPrice/t.time);u.efficiency=F;var B=0;return i&&u.rankVal>0&&(B=F),u.chefEff=B,u}function calAddition(i,e){return+((i+e.abs)*(1+e.percent/100)).toFixed(2)}function getTimeAddition(i){var e=0;for(var t in i)"OpenTime"==i[t].type&&(e+=i[t].value);return+e.toFixed(2)}function updateEquipmentEffect(i,e){var t=i;for(var a in e)if("MutiEquipmentSkill"==e[a].type)for(var r in t=JSON.parse(JSON.stringify(i)),t){var n=new Addition;setAddition(n,e[a]),t[r].value=calAddition(t[r].value,n)}return t}function setAddition(i,e){"Abs"==e.cal?i.abs=+(i.abs+e.value).toFixed(2):"Percent"==e.cal&&(i.percent=+(i.percent+e.value).toFixed(2))}function Addition(){this.abs=0,this.percent=0}function secondsToTime(i){i=Number(i);var e=Math.floor(i/3600/24),t=Math.floor(i/3600%24),a=Math.floor(i/60%60),r=Math.floor(i%60),n="";return e>0&&(n+=e+"天"),t>0&&(n+=t+"小时"),a>0&&(n+=a+"分"),r>0&&(n+=r+"秒"),n}function getEquipInfo(i,e){var t=null;if(i)for(var a in e)if(i==e[a].equipId)return e[a];return t}function getCondimentInfo(i,e){var t=null;if(i)for(var a in e)if(i==e[a].condimentId)return e[a];return t}function setDataForChef(i,e,t,a,r,n,o,f,s,l){var c=new Addition,d=new Addition,p=new Addition,u=new Addition,m=new Addition,b=new Addition,v=0,h=0,y=0,A=0,k=new Addition,D=new Addition,g=new Addition,S=new Addition,M=new Addition,V=new Addition,E=[];if(i.selfUltimateEffect=[],!l||!l.hasOwnProperty("DisableChefSkillEffect")||0==l.DisableChefSkillEffect){if(E=E.concat(i.specialSkillEffect),E=E.concat(a),o)for(var P in o)if(i.chefId==o[P].chefId){i.selfUltimateEffect=o[P].effect,E=E.concat(o[P].effect);break}var I=!1;if(r)for(var P in r)if(i.chefId==r[P].chefId){E=E.concat(r[P].effect),I=!0;break}if(n)for(var P in n)i.chefId==n[P].chefId&&I||(E=E.concat(n[P].effect))}if((!l||!l.hasOwnProperty("DisableEquipSkillEffect")||0==l.DisableEquipSkillEffect)&&t&&e&&e.effect){var w=updateEquipmentEffect(e.effect,i.selfUltimateEffect);E=E.concat(w)}for(var P in f&&(E=E.concat(f)),E){var C=E[P].type,U=E[P].tag;U&&i.tags.indexOf(U)<0||("Stirfry"==C?setAddition(c,E[P]):"Boil"==C?setAddition(d,E[P]):"Knife"==C?setAddition(p,E[P]):"Fry"==C?setAddition(u,E[P]):"Bake"==C?setAddition(m,E[P]):"Steam"==C?setAddition(b,E[P]):"Meat"==C?v+=E[P].value:"Creation"==C?h+=E[P].value:"Vegetable"==C?y+=E[P].value:"Fish"==C?A+=E[P].value:"Sweet"==C?setAddition(k,E[P]):"Sour"==C?setAddition(D,E[P]):"Spicy"==C?setAddition(g,E[P]):"Salty"==C?setAddition(S,E[P]):"Bitter"==C?setAddition(M,E[P]):"Tasty"==C&&setAddition(V,E[P]))}i.meatVal=i.meat+v,i.creationVal=i.creation+h,i.vegVal=i.veg+y,i.fishVal=i.fish+A,i.meatDisp=getAtrributeDisp(i.meatVal,i.meat,s),i.creationDisp=getAtrributeDisp(i.creationVal,i.creation,s),i.vegDisp=getAtrributeDisp(i.vegVal,i.veg,s),i.fishDisp=getAtrributeDisp(i.fishVal,i.fish,s),i.stirfryVal=Math.ceil(calAddition(i.stirfry,c)),i.boilVal=Math.ceil(calAddition(i.boil,d)),i.knifeVal=Math.ceil(calAddition(i.knife,p)),i.fryVal=Math.ceil(calAddition(i.fry,u)),i.bakeVal=Math.ceil(calAddition(i.bake,m)),i.steamVal=Math.ceil(calAddition(i.steam,b)),i.stirfryDisp=getAtrributeDisp(i.stirfryVal,i.stirfry,s),i.boilDisp=getAtrributeDisp(i.boilVal,i.boil,s),i.knifeDisp=getAtrributeDisp(i.knifeVal,i.knife,s),i.fryDisp=getAtrributeDisp(i.fryVal,i.fry,s),i.bakeDisp=getAtrributeDisp(i.bakeVal,i.bake,s),i.steamDisp=getAtrributeDisp(i.steamVal,i.steam,s),i.sweetVal=Math.ceil(calAddition(i.sweet,k)),i.sourVal=Math.ceil(calAddition(i.sour,D)),i.spicyVal=Math.ceil(calAddition(i.spicy,g)),i.saltyVal=Math.ceil(calAddition(i.salty,S)),i.bitterVal=Math.ceil(calAddition(i.bitter,M)),i.tastyVal=Math.ceil(calAddition(i.tasty,V)),i.sweetDisp=getAtrributeDisp(i.sweetVal,i.sweet,s),i.sourDisp=getAtrributeDisp(i.sourVal,i.sour,s),i.spicyDisp=getAtrributeDisp(i.spicyVal,i.spicy,s),i.saltyDisp=getAtrributeDisp(i.saltyVal,i.salty,s),i.bitterDisp=getAtrributeDisp(i.bitterVal,i.bitter,s),i.tastyDisp=getAtrributeDisp(i.tastyVal,i.tasty,s),i.disp="<span class='name'>"+i.name+"</span><br><small>";var R=0;i.stirfryDisp&&(i.disp+="炒"+i.stirfryDisp+" ",R++),i.boilDisp&&(i.disp+="煮"+i.boilDisp+" ",R++,R%2==0&&(i.disp+="<br>")),i.knifeDisp&&(i.disp+="切"+i.knifeDisp+" ",R++,R%2==0&&(i.disp+="<br>")),i.fryDisp&&(i.disp+="炸"+i.fryDisp+" ",R++,R%2==0&&(i.disp+="<br>")),i.bakeDisp&&(i.disp+="烤"+i.bakeDisp+" ",R++,R%2==0&&(i.disp+="<br>")),i.steamDisp&&(i.disp+="蒸"+i.steamDisp+" "),i.disp+="</small>"}function getAtrributeDisp(i,e,t){var a="";if(t)return i&&(a=i),a;e&&(a+=e);var r=i-e;return r&&(r>0&&(a+="+"),a+=r),a}function getRarityDisp(i){for(var e="",t=0;t<i;t++)e+="&#x2605;";return e}function isNumeric(i){return!isNaN(parseFloat(i))&&isFinite(i)}function getPartialUltimateData(i,e,t,a){var r=[];if(t)for(var n in a)for(var o in i)if(a[n]==i[o].chefId){for(var f in e)if(i[o].ultimateSkill==e[f].skillId){var s=[];for(var l in e[f].effect)"Partial"==e[f].effect[l].condition&&s.push(JSON.parse(JSON.stringify(e[f].effect[l])));if(s.length){var c={};c.chefId=i[o].chefId,c.effect=s,r.push(c)}break}break}return r}function updatePartialUltimateDataCondition(i,e){for(var t in i)for(var a in e)i[t].chef.chefId==e[a].chefId&&updateConditionMatch(e[a].effect,i[t].chef,null,null,i[t].recipes)}function getSelfUltimateData(i,e,t,a){var r=[];if(t)for(var n in a)for(var o in i)if(a[n]==i[o].chefId){for(var f in e)if(i[o].ultimateSkill==e[f].skillId){var s=[];for(var l in e[f].effect)"Self"==e[f].effect[l].condition&&s.push(e[f].effect[l]);if(s.length){var c={};c.chefId=i[o].chefId,c.effect=s,r.push(c)}break}break}return r}function updateMaterialsData(i,e,t){for(var a in e.data.materials)for(var r in i)e.data.materials[a].material==i[r].materialId&&Number.isInteger(parseInt(i[r].quantity))&&(i[r].quantity-=e.data.materials[a].quantity*t)}function getMaxNSum(i,e){i.sort(function(i,e){return e.totalScore-i.totalScore});for(var t=0,a=Math.min(i.length,e),r=0;r<a;r++)t+=i[r].totalScore;return t}function getMaxNSumRecipes(i,e){var t=[];for(var a in i)for(var r in i[a].recipes)t.push(i[a].recipes[r]);t.sort(function(i,e){return e.totalScore-i.totalScore});var n=[],o=[],f=0;for(var s in t)if(o.indexOf(t[s].recipeId)<0&&(o.push(t[s].recipeId),n.push(t[s]),o.length<=e.rule.RecipesNumLimit&&(f+=t[s].totalScore),o.length==e.rule.ChefNumLimit*e.rule.RecipesNumLimit))break;return{recipes:n,sum:f}}